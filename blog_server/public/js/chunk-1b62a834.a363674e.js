(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1b62a834"],{"1dde":function(t,e,a){var s=a("d039"),n=a("b622"),i=a("2d00"),r=n("species");t.exports=function(t){return i>=51||!s((function(){var e=[],a=e.constructor={};return a[r]=function(){return{foo:1}},1!==e[t](Boolean).foo}))}},"3e9d":function(t,e,a){"use strict";var s=a("dad7"),n=a.n(s);n.a},"8fc4":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"message"}},[a("Nav"),a("div",{staticClass:"message-main"},[a("div",{staticClass:"message-edit"},[t._m(0),a("RichText",{on:{Sub:t.submitMessage}})],1),a("ul",{staticClass:"message-list"},t._l(t.commentList,(function(e,s){return a("li",{key:e._id,staticClass:"message-item"},[a("div",{staticClass:"p-u-info"},[a("span",{staticClass:"img",style:{backgroundImage:"url("+e.user.avatar+")"}}),a("span",{staticClass:"user"},[t._v(t._s(e.user.username))])]),a("div",{staticClass:"content"},[a("div",{staticClass:"text",domProps:{innerHTML:t._s(e.content)}}),a("div",{staticClass:"time"},[a("span",[t._v(t._s(t._f("getTime")(e.date)))]),a("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.replyClick(s)}}},[t._v(" "+t._s(e.reply.lastIndexArr[0]===s&&void 0===e.reply.lastIndexArr[1]?"收起":"回复")+" ")])])]),a("ul",{staticClass:"sub-list"},t._l(e.children,(function(n,i){return a("li",{key:i+100*Math.random(),staticClass:"sub-item"},[a("div",{staticClass:"img",style:{backgroundImage:"url("+n.user.avatar+")"}}),a("div",{staticClass:"content"},[a("div",[a("span",{staticClass:"name"},[t._v(t._s(n.user.username))]),a("span",[t._v("回复")]),a("span",{staticClass:"name"},[t._v(t._s(n.atUserName))]),a("span",{staticClass:"content"},[t._v(t._s(n.content))])]),a("div",[a("span",{staticClass:"time"},[t._v(t._s(t._f("getTime")(n.date)))]),a("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.replyClick(s,i)}}},[t._v(" "+t._s(e.reply.lastIndexArr[0]===s&&e.reply.lastIndexArr[1]===i?"收起":"回复")+" ")])])])])})),0),a("div",{class:["reply",{show:e.reply.ifShow}]},[a("textarea",{directives:[{name:"model",rawName:"v-model",value:e.reply.content,expression:"item.reply.content"}],attrs:{placeholder:"回复【"+e.reply.atUserName+"】"},domProps:{value:e.reply.content},on:{input:function(a){a.target.composing||t.$set(e.reply,"content",a.target.value)}}}),a("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(e){return t.submitSubMessage(s)}}},[t._v("提交")])],1)])})),0),a("div",{staticClass:"pagination"},[a("el-pagination",{attrs:{"current-page":t.currentPage,"page-sizes":[5,10,15,20],"page-size":5,layout:"sizes, prev, pager, next",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange,"update:currentPage":function(e){t.currentPage=e},"update:current-page":function(e){t.currentPage=e}}})],1)])],1)},n=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"desc"},[a("h1",[t._v("留言板")]),a("p",[t._v("您的建议让网站得到优化！！！")])])}],i=(a("d81d"),a("216c")),r=a("d2a0"),c=a("3a2d"),o=a("365c"),u={addMessage:function(t){return o["a"].post("/api/message/addMessage",t)},addSubMessage:function(t){return o["a"].post("/api/message/addSubMessage",t)},getMessageList:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;return o["a"].get("/api/message/getMessageList",{params:{skip:t,limit:e}})},getCountMessage:function(){return o["a"].get("/api/message/getCountMessage")}},l={name:"index",components:{Nav:i["a"],RichText:r["a"]},data:function(){return{commentList:[],currentPage:1,total:0,skip:0,limit:5}},filters:{getTime:function(t){var e=new Date(t),a=e.getFullYear(),s=e.getMinutes()+1,n=e.getDay(),i=e.getHours(),r=e.getMinutes(),c=e.getSeconds();return a+"/"+s+"/"+n+" "+i+":"+r+":"+c}},methods:{submitMessage:function(t){if(!t)return layer.msg("请输入内容",{icon:2}),!1;c["a"].getIfUserLogin().then((function(e){var a=e.data;a.ifLogin?u.addMessage({userId:a.data._id,content:t}).then((function(t){0===t.data.code?(layer.msg("留言成功",{icon:1}),setTimeout((function(){window.location.reload()}),1e3)):layer.msg(t.data.msg,{icon:2})})).catch((function(t){layer.msg("服务器错误~请稍后重试",{icon:2})})):layer.msg("清先登录",{icon:2})}))},submitSubMessage:function(t){var e=this;c["a"].getIfUserLogin().then((function(a){var s=a.data;s.ifLogin?u.addSubMessage({parentId:e.commentList[t]._id,userId:s.data._id,content:e.commentList[t].reply.content,atUserName:e.commentList[t].reply.atUserName}).then((function(t){0===t.data.code?(layer.msg("留言成功",{icon:1}),setTimeout((function(){window.location.reload()}),1e3)):layer.msg(t.data.msg,{icon:2})})).catch((function(t){layer.msg("服务器错误~请稍后重试",{icon:2})})):layer.msg("清先登录",{icon:2})}))},replyClick:function(t,e){if(void 0!==t){var a=this.commentList[t];t===a.reply.lastIndexArr[0]&&e===a.reply.lastIndexArr[1]?(a.reply.ifShow=!1,a.reply.lastIndexArr=[]):(a.reply.ifShow=!0,a.reply.lastIndexArr=[t,e]),a.reply.atUserName=void 0===e?a.user.username:a.children[e].user.username}},getMessageList:function(){var t=this;u.getMessageList(this.skip,this.limit).then((function(e){var a=e.data;0===a.code&&a.data&&(t.commentList=a.data.map((function(t){return t.reply={userId:"",content:"",atUserName:"",date:"",ifShow:!1,lastIndexArr:[]},t})))}))},getCountMessage:function(){var t=this;u.getCountMessage().then((function(e){var a=e.data;0===a.code&&(t.total=a.total)}))},handleSizeChange:function(t){this.limit=t,this.skip=(this.currentPage-1)*this.limit,this.getMessageList(this.skip,this.limit)},handleCurrentChange:function(t){this.skip=(t-1)*this.limit,this.getMessageList(this.skip,this.limit)}},mounted:function(){this.getMessageList(),this.getCountMessage()}},d=l,g=(a("3e9d"),a("2877")),m=Object(g["a"])(d,s,n,!1,null,"be574686",null);e["default"]=m.exports},d2a0:function(t,e,a){"use strict";var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("textarea",{staticStyle:{display:"none"},attrs:{id:"richText"}}),a("el-button",{staticStyle:{"margin-top":"10px"},attrs:{type:"primary"},on:{click:t.handleSubmit}},[t._v("提交留言")])],1)},n=[],i={name:"RichText",data:function(){return{layedit:null,index:0}},methods:{handleSubmit:function(){this.$emit("Sub",this.layedit.getContent(this.index))}},mounted:function(){var t=this;layui.use("layedit",(function(){t.layedit=layui.layedit,t.index=t.layedit.build("richText",{tool:["face"],height:150})}))}},r=i,c=a("2877"),o=Object(c["a"])(r,s,n,!1,null,"2ad26fc7",null);e["a"]=o.exports},d81d:function(t,e,a){"use strict";var s=a("23e7"),n=a("b727").map,i=a("1dde"),r=a("ae40"),c=i("map"),o=r("map");s({target:"Array",proto:!0,forced:!c||!o},{map:function(t){return n(this,t,arguments.length>1?arguments[1]:void 0)}})},dad7:function(t,e,a){}}]);
//# sourceMappingURL=chunk-1b62a834.a363674e.js.map